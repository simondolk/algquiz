<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Algquiz – Södra Sverige (30 arter)</title>
  <style>
    :root{
      --brand:#0b6ea8; --accent:#0aa770; --bg:#f6f8fb; --text:#1f2937; --muted:#6b7280; --danger:#c0392b;
    }
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;margin:0;background:var(--bg);color:var(--text);}
    header{padding:1rem 1.25rem;border-bottom:1px solid #e5e7eb;background:#fff;position:sticky;top:0;z-index:5}
    h1{font-size:1.4rem;margin:.2rem 0}
    .wrap{max-width:1100px;margin:0 auto;padding:1.25rem}
    .grid{display:grid;grid-template-columns:1fr 380px;gap:1rem}
    @media (max-width:960px){.grid{grid-template-columns:1fr}}
    .card{background:#fff;border:1px solid #e5e7eb;border-radius:.75rem;box-shadow:0 1px 2px rgba(0,0,0,.03);overflow:hidden}
    .imgBox{aspect-ratio:4/3;background:#eef2f7;display:flex;align-items:center;justify-content:center}
    .imgBox img{max-width:100%;max-height:100%;object-fit:contain}
    .controls{display:flex;align-items:center;justify-content:space-between;padding:.5rem .75rem;border-top:1px solid #e5e7eb}
    button{cursor:pointer;border:none;border-radius:.5rem;background:var(--brand);color:#fff;padding:.6rem .9rem;font-weight:600}
    button.secondary{background:#eef2f7;color:#111;border:1px solid #e5e7eb}
    button.ghost{background:transparent;color:var(--brand);border:1px solid var(--brand)}
    button.link{background:transparent;color:var(--brand);border:none;padding:.25rem .4rem}
    .danger{background:var(--danger)}
    .ok{background:var(--accent)}
    .muted{color:var(--muted)}
    .panel{padding:1rem}
    .row{display:flex;gap:.5rem;align-items:center;flex-wrap:wrap}
    .row > *{margin:.15rem 0}
    input[type="text"]{width:100%;padding:.7rem .8rem;border:1px solid #d1d5db;border-radius:.5rem;font-size:1rem}
    select{padding:.6rem .8rem;border:1px solid #d1d5db;border-radius:.5rem;font-size:1rem;background:#fff}
    .badge{display:inline-flex;align-items:center;gap:.4rem;background:#eef2f7;border:1px solid #e5e7eb;color:#374151;padding:.2rem .5rem;border-radius:.4rem;font-size:.85rem}
    .score{font-weight:700}
    .sliderBox{display:flex;align-items:center;gap:.6rem}
    input[type="range"]{width:150px}
    .answer{margin-top:.5rem}
    .answer .correct{color:var(--accent);font-weight:700}
    .answer .wrong{color:var(--danger);font-weight:700}
    footer{padding:1rem 1.25rem;color:#6b7280}
    details{margin-top:.6rem}
    .mc-options{display:grid;grid-template-columns:1fr 1fr;gap:.5rem;margin:.5rem 0}
    .mc-options button{background:#fff;color:#111;border:1px solid #e5e7eb;text-align:left}
    .mc-options button.correct{border-color:var(--accent)}
    .mc-options button.incorrect{border-color:var(--danger)}
    .pill{background:#fff;border:1px solid #e5e7eb;border-radius:999px;padding:.3rem .65rem}
  </style>
</head>
<body>

<header class="wrap">
  <h1>Algquiz</h1>
  <div class="row">
    <span class="badge">Fråga: <span id="qNum">1</span> / <span id="qTotal">30</span></span>
    <span class="badge">Poäng: <span class="score" id="score">0</span></span>
    <span class="badge">Läge: <strong id="modeLabel">Fritext</strong></span>
    <span class="badge">Stavfels­tolerans: <span id="tolLabel">medel</span></span>
  </div>
</header>

<main class="wrap grid">
  <section class="card">
    <div class="imgBox" id="imgBox" aria-live="polite">
      <img id="algImg" alt="Algfoto i quizet" src="" />
    </div>
    <div class="controls">
      <button id="prevBtn" class="secondary" title="Föregående">←</button>
      <div class="row">
        <button id="showBtn" class="ghost">Visa rätt svar</button>
        <button id="checkBtn" class="">Kontrollera</button>
        <button id="nextBtn" class="ok">Nästa →</button>
      </div>
    </div>
  </section>

  <aside class="card">
    <div class="panel">
      <h2>Vad heter denna alg?</h2>

      <div class="row" style="justify-content:space-between">
        <div class="row">
          <label class="pill"><input type="radio" name="mode" value="text" checked> Fritext</label>
          <label class="pill"><input type="radio" name="mode" value="mc"> Flervalsfråga</label>
        </div>
        <div class="sliderBox">
          <label for="tol">Tolerans</label>
          <input type="range" id="tol" min="0" max="2" step="1" value="1" />
        </div>
      </div>

      <!-- Fritext -->
      <div id="textBox">
        <input id="answerInput" type="text" placeholder="Skriv svenskt namn (latin går också bra)..." autocomplete="off" />
        <div class="answer" id="answerMsg"></div>
      </div>

      <!-- Flervalsläge -->
      <div id="mcBox" style="display:none">
        <div class="mc-options" id="mcOptions"></div>
        <div id="mcMsg" class="answer"></div>
      </div>

      <details>
        <summary>Tips</summary>
        <ul>
          <li>Stavfel tolereras. Även latinska namn och vanliga synonymer godkänns.</li>
          <li>Å/Ä/Ö jämställs med A/A/O, mellanslag och bindestreck ignoreras.</li>
          <li>“Visa rätt svar” avslöjar det korrekta namnet för den aktuella bilden.</li>
        </ul>
      </details>
    </div>
  </aside>
</main>

<footer class="wrap">
  <small class="muted">Byggd för undervisning: södra Sveriges vanliga makroalger (Kattegatt/Öresund). Bilder läggs i <code>/images</code> i ditt repo och mappas i artlistan.</small>
</footer>

<script>
/*** =======================
 *  KONFIGURATION BILDER
 *  ======================= */
// TODO: ÄNDRA denna bas-URL till din GitHub Pages- eller raw‑URL för bildmappen
// Ex GitHub Pages: https://anvandarnamn.github.io/repo/images/
// Ex raw:         https://raw.githubusercontent.com/anvandarnamn/repo/main/images/
const BASE_IMAGE_URL = "https://simondolk.github.io/repo/images/";

/*** =======================
 *  HJÄLPLIGA FUNKTIONER
 *  ======================= */
const norm = (s) => {
  if (!s) return "";
  // Normalisera, ta bort diakritiska tecken, ersätt å/ä/ö, ta bort mellanrum o. skiljetecken
  return s.toLowerCase()
    .normalize("NFKD")
    .replace(/[\u0300-\u036f]/g, "") // diakriter
    .replace(/å/g,"a").replace(/ä/g,"a").replace(/ö/g,"o")
    .replace(/[^a-z0-9]/g,""); // ta bort mellanslag o. icke-alnum
};

// Levenshtein-avstånd
function lev(a,b){
  const m=a.length, n=b.length;
  if(m===0) return n; if(n===0) return m;
  const dp=Array.from({length:m+1},()=>new Array(n+1).fill(0));
  for(let i=0;i<=m;i++) dp[i][0]=i;
  for(let j=0;j<=n;j++) dp[0][j]=j;
  for(let i=1;i<=m;i++){
    for(let j=1;j<=n;j++){
      const cost = a[i-1]===b[j-1]?0:1;
      dp[i][j]=Math.min(
        dp[i-1][j]+1,      // borttag
        dp[i][j-1]+1,      // insättning
        dp[i-1][j-1]+cost  // ersätt
      );
    }
  }
  return dp[m][n];
}

// Bedöm om användarens svar ≈ korrekt (med tolerans)
function isMatch(userInput, item, tolLevel){
  // tolLevel: 0=låg, 1=medel, 2=hög
  const cand = norm(userInput);
  const accepted = [
    item.commonName,
    item.latinName,
    ...(item.aliases||[])
  ].map(norm);

  // exakt träff
  if (accepted.includes(cand)) return true;

  // Levenshtein med relativ tröskel
  const maxLen = Math.max(1, ...accepted.map(s=>s.length));
  const base = tolLevel===0 ? 0.12 : (tolLevel===1 ? 0.20 : 0.28); // 12% / 20% / 28%
  const maxDist = Math.ceil(base * maxLen);

  return accepted.some(acc => lev(cand, acc) <= maxDist || acc.includes(cand) || cand.includes(acc));
}

// Slumpa ur array
const sample = (arr, n) => {
  const a = [...arr];
  for(let i=a.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a.slice(0,n);
};

/*** =======================
 *  ARTBANK – 30 arter
 *  ======================= */
// OBS: Byt ut filnamn i images: ["bild1.jpg","bild2.jpg"] osv.
// Du kan lägga flera bilder per art. Programmet roterar inom arten.
const BANK = [
  // —— Brunalger
  { commonName:"Blåstång", latinName:"Fucus vesiculosus", group:"Brunalger",
    aliases:["blastang","blue tang","bladder wrack"],
    images:["blastang_1.jpg","blastang_2.jpg","blastang_3.jpg"] },
  { commonName:"Sågtång", latinName:"Fucus serratus", group:"Brunalger",
    aliases:["sagtang","serrated wrack"],
    images:["sagtang_1.jpg"] },
  { commonName:"Spiraltång", latinName:"Fucus spiralis", group:"Brunalger",
    aliases:["spiraltang"],
    images:["spiraltang_1.jpg"] },
  { commonName:"Knöltång", latinName:"Ascophyllum nodosum", group:"Brunalger",
    aliases:["knoltag","grisetång","grisetang"],
    images:["knoltang_1.jpg"] },
  { commonName:"Stortare", latinName:"Laminaria hyperborea", group:"Brunalger",
    aliases:["stortare","kelp"],
    images:["stortare_1.jpg"] },
  { commonName:"Fingertare", latinName:"Laminaria digitata", group:"Brunalger",
    aliases:["fingertare","oarweed"],
    images:["fingertare_1.jpg"] },
  { commonName:"Sockertare", latinName:"Saccharina latissima", group:"Brunalger",
    aliases:["bladtång","sockertang","sockertång","skrӓppetare","skrappetare"],
    images:["sockertare_1.jpg"] },
  { commonName:"Remtång", latinName:"Himanthalia elongata", group:"Brunalger",
    aliases:["knapptång","remtang","sea thong"],
    images:["remtang_1.jpg"] },
  { commonName:"Sudare", latinName:"Chorda filum", group:"Brunalger",
    aliases:["snärjtång","snarjtang","dead mans rope"],
    images:["sudare_1.jpg"] },
  { commonName:"Ektång", latinName:"Halidrys siliquosa", group:"Brunalger",
    aliases:["ektang","sea oak"],
    images:["ektang_1.jpg"] },
  { commonName:"Tångludd", latinName:"Elachista fucicola", group:"Brunalger",
    aliases:["tangludd","elachista"],
    images:["tangludd_1.jpg"] },
  { commonName:"Ektofs", latinName:"Sphacelaria cirrosa", group:"Brunalger",
    aliases:["sphacelaria","ektofs"],
    images:["ektofs_1.jpg"] },
  { commonName:"Sargassosnärja", latinName:"Sargassum muticum", group:"Brunalger",
    aliases:["japansk sargassotång","sargassosnarja","sargassum"],
    images:["sargassosnarja_1.jpg"] },

  // —— Grönalger
  { commonName:"Havssallat", latinName:"Ulva lactuca", group:"Grönalger",
    aliases:["havsalat","sea lettuce","ulva"],
    images:["havssallat_1.jpg"] },
  { commonName:"Östersjösallat", latinName:"Ulva fenestrata", group:"Grönalger",
    aliases:["sea lettuce","ulva fenestrata"],
    images:["ostersjosallat_1.jpg"] },
  { commonName:"Tarmalg", latinName:"Ulva intestinalis", group:"Grönalger",
    aliases:["tarmtång","tarmgrönske","enteromorpha"],
    images:["tarmalg_1.jpg"] },
  { commonName:"Grönslick", latinName:"Cladophora glomerata", group:"Grönalger",
    aliases:["gronslick","cladophora"],
    images:["gronslick_1.jpg"] },
  { commonName:"Strutsallat", latinName:"Monostroma grevillei", group:"Grönalger",
    aliases:["monostroma"],
    images:["strutsallat_1.jpg"] },
  { commonName:"Grönplym", latinName:"Bryopsis plumosa", group:"Grönalger",
    aliases:["bryopsis","gronplym"],
    images:["gronplym_1.jpg"] },

  // —— Rödalger
  { commonName:"Korallalg", latinName:"Corallina officinalis", group:"Rödalger",
    aliases:["corallina","korallalger"],
    images:["korallalg_1.jpg"] },
  { commonName:"Kräkel", latinName:"Furcellaria lumbricalis", group:"Rödalger",
    aliases:["gaffeltång","gaffeltang","furcellaria"],
    images:["krakel_1.jpg"] },
  { commonName:"Rödslick", latinName:"Polysiphonia spp.", group:"Rödalger",
    aliases:["polysiphonia","rodslick"],
    images:["rodslick_1.jpg"] },
  { commonName:"Grovslick", latinName:"Polysiphonia elongata", group:"Rödalger",
    aliases:["grovslick","polysiphonia elongata"],
    images:["grovslick_1.jpg"] },
  { commonName:"Ullsläke", latinName:"Ceramium tenuicorne", group:"Rödalger",
    aliases:["ceramium","ullslake"],
    images:["ullslake_1.jpg"] },
  { commonName:"Rosenslick", latinName:"Rhodomela confervoides", group:"Rödalger",
    aliases:["rhodomela","rosenslick"],
    images:["rosenslick_1.jpg"] },
  { commonName:"Söl", latinName:"Palmaria palmata", group:"Rödalger",
    aliases:["dulse","sol"],
    images:["sol_1.jpg"] },
  { commonName:"Karragenalg", latinName:"Chondrus crispus", group:"Rödalger",
    aliases:["karragentång","irländsk mossa","carrageen"],
    images:["karragenalg_1.jpg"] },
  { commonName:"Ribbeblad", latinName:"Delesseria sanguinea", group:"Rödalger",
    aliases:["nervtång","ribbeblad"],
    images:["ribbeblad_1.jpg"] },
  { commonName:"Klyving", latinName:"Polyides rotunda", group:"Rödalger",
    aliases:["polyides rotundus","klyving"],
    images:["klyving_1.jpg"] },
  { commonName:"Blåtonat rödblad", latinName:"Phyllophora pseudoceranoides", group:"Rödalger",
    aliases:["phyllophora","blatonat rodblad"],
    images:["phyllophora_1.jpg"] },
  { commonName:"Havsrufse", latinName:"Ahnfeltia plicata", group:"Rödalger",
    aliases:["ahnfeltia","sjöris","landladys wig"],
    images:["ahnfeltia_1.jpg"] },
  { commonName:"Grov agaralg", latinName:"Gracilaria vermiculophylla", group:"Rödalger",
    aliases:["slemsnärja","grov agar","gracilaria"],
    images:["gracilaria_1.jpg"] }
];

// Här kan du snabbt begränsa mängden frågor (BANK.length = 30).
const QUIZ = BANK.map(item => ({
  ...item,
  // prefixa varje bild med bas-URL
  images: (item.images||[]).map(file => BASE_IMAGE_URL + file)
}));

/*** =======================
 *  TILLSTÅND / UI
 *  ======================= */
let idx = 0;
let score = 0;
let usedImagesIndex = {}; // håller koll på vilken bild inom arten som visas
let mode = "text"; // eller "mc"
let tolLevel = 1;  // 0=låg,1=medel,2=hög
let mcCorrect = null;

const qNum = document.getElementById("qNum");
const qTotal = document.getElementById("qTotal");
const scoreEl = document.getElementById("score");
const imgEl = document.getElementById("algImg");
const answerInput = document.getElementById("answerInput");
const answerMsg = document.getElementById("answerMsg");
const showBtn = document.getElementById("showBtn");
const checkBtn = document.getElementById("checkBtn");
const prevBtn = document.getElementById("prevBtn");
const nextBtn = document.getElementById("nextBtn");
const modeLabel = document.getElementById("modeLabel");
const tol = document.getElementById("tol");
const tolLabel = document.getElementById("tolLabel");
const mcBox = document.getElementById("mcBox");
const textBox = document.getElementById("textBox");
const mcOptionsEl = document.getElementById("mcOptions");
const mcMsg = document.getElementById("mcMsg");

qTotal.textContent = QUIZ.length.toString();

function setTolLabel(){
  tolLabel.textContent = tolLevel===0?"låg":(tolLevel===1?"medel":"hög");
}
setTolLabel();

function render(){
  const item = QUIZ[idx];
  qNum.textContent = (idx+1).toString();
  scoreEl.textContent = score.toString();
  answerMsg.innerHTML = "";
  mcMsg.innerHTML = "";

  // växla bild inom samma art för variation
  const arr = item.images && item.images.length ? item.images : [""];
  const local = usedImagesIndex[item.commonName] || 0;
  const nextLocal = (local + 1) % arr.length;
  usedImagesIndex[item.commonName] = nextLocal;

  imgEl.src = arr[local] || "";
  imgEl.alt = `Foto av ${item.commonName} (${item.latinName})`;

  // bygg flervalsalternativ
  if(mode==="mc"){
    buildMC(item);
  }
}

function buildMC(item){
  mcOptionsEl.innerHTML = "";
  const distractors = sample(
    QUIZ.filter(x => x.commonName!==item.commonName && x.group===item.group), 3
  );
  const options = sample([item, ...distractors], 4);
  mcCorrect = item.commonName;

  options.forEach(opt => {
    const b = document.createElement("button");
    b.textContent = opt.commonName;
    b.onclick = () => {
      [...mcOptionsEl.children].forEach(c => c.disabled = true);
      if(opt.commonName===item.commonName){
        b.classList.add("correct");
        mcMsg.innerHTML = `<span class="correct">Rätt!</span> ${item.commonName} (${item.latinName})`;
        score++;
        scoreEl.textContent = score.toString();
      }else{
        b.classList.add("incorrect");
        mcMsg.innerHTML = `<span class="wrong">Fel.</span> Rätt svar: <strong>${item.commonName}</strong> (${item.latinName})`;
      }
    };
    mcOptionsEl.appendChild(b);
  });
}

// Händelser
document.querySelectorAll('input[name="mode"]').forEach(r => {
  r.addEventListener("change", e => {
    mode = e.target.value;
    modeLabel.textContent = mode==="text"?"Fritext":"Flervalsfråga";
    textBox.style.display = mode==="text" ? "block" : "none";
    mcBox.style.display = mode==="mc" ? "block" : "none";
    render();
  });
});
tol.addEventListener("input", e => {
  tolLevel = parseInt(e.target.value,10);
  setTolLabel();
});

checkBtn.addEventListener("click", () => {
  const item = QUIZ[idx];
  if(mode==="text"){
    const val = answerInput.value.trim();
    if(!val){
      answerMsg.innerHTML = `<span class="muted">Skriv ett namn först.</span>`;
      return;
    }
    const ok = isMatch(val, item, tolLevel);
    if(ok){
      answerMsg.innerHTML = `<span class="correct">Rätt!</span> ${item.commonName} (${item.latinName})`;
      score++;
      scoreEl.textContent = score.toString();
    }else{
      answerMsg.innerHTML = `<span class="wrong">Inte riktigt.</span> Försök igen eller klicka “Visa rätt svar”.`;
    }
  }else{
    mcMsg.innerHTML = `<span class="muted">Välj ett alternativ ovan.</span>`;
  }
});

showBtn.addEventListener("click", () => {
  const item = QUIZ[idx];
  const also = (item.aliases && item.aliases.length) ? ` | alias: ${item.aliases.slice(0,3).join(", ")}${item.aliases.length>3?"…":""}` : "";
  if(mode==="text"){
    answerMsg.innerHTML = `Rätt svar: <strong>${item.commonName}</strong> (${item.latinName})${also}`;
  }else{
    mcMsg.innerHTML = `Rätt svar: <strong>${item.commonName}</strong> (${item.latinName})${also}`;
  }
});

prevBtn.addEventListener("click", () => {
  idx = (idx-1+QUIZ.length)%QUIZ.length;
  answerInput.value = "";
  render();
});

nextBtn.addEventListener("click", () => {
  idx = (idx+1)%QUIZ.length;
  answerInput.value = "";
  render();
});

// Init
render();
</script>
</body>
</html>
